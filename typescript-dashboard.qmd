---
title: TypeScript Migration Dashboard
format:
  dashboard:
    logo: images/ts-logo-256.svg
    nav-buttons:
      - icon: github
        href: https://github.com/mcgaffin/composition-api-migration
        target: _parent
---

```{r setup}
source("R/github_utils.R")

request_by_extension <- function(ext) {
  query <- glue('"import"+extension:{ext}+repo:posit-dev/connect+path:ui/src')
  request_github_search(query)
}
```

```{r typescript-vue-components}
# Vue components with TypeScript (have lang="ts" in script setup)
ts_vue_results <- request_all_pages("setup%20lang", language = "Vue")

ts_vue_count <- ts_vue_results$count
ts_vue_components <- ts_vue_results$items |>
  map(get_names_from_git_response)
```

```{r javascript-vue-components}
# All Vue components using Composition API (script setup)
all_vue_results <- request_all_pages("script%20setup", language = "Vue")

all_vue_count <- all_vue_results$count
all_vue_items <- all_vue_results$items

# Filter out TypeScript Vue components to get JavaScript Vue components
ts_vue_paths <- ts_vue_results$items |> map_chr(~.x$path)
js_vue_items <- all_vue_items |> keep(~!(.x$path %in% ts_vue_paths))

js_vue_count <- length(js_vue_items)
js_vue_components <- js_vue_items |>
  map(get_names_from_git_response)
```

```{r typescript-files}
# TypeScript files (*.ts)
ts_file_results <- request_by_extension("ts")

ts_file_count <- ts_file_results$count
ts_files <- ts_file_results$items |>
  map(get_names_from_git_response)
```

```{r javascript-files}
# JavaScript files (*.js)
js_file_results <- request_by_extension("js")

js_file_count <- js_file_results$count
js_files <- js_file_results$items |>
  map(get_names_from_git_response)
```

## Row

```{r}
#| content: valuebox
#| title: "Vue Component Progress"
#| icon: filetype-tsx
#| color: primary

glue('{calculate_progress(ts_vue_count, js_vue_count)}%')
```

```{r}
#| content: valuebox
#| title: "File Progress"
#| icon: file-earmark-code
#| color: primary

glue('{calculate_progress(ts_file_count, js_file_count)}%')
```

## Row

```{r}
#| content: valuebox
#| title: "TypeScript Vue Components"
#| icon: check-lg
#| color: success

ts_vue_count
```

```{r}
#| content: valuebox
#| title: "JavaScript Vue Components"
#| icon: hourglass
#| color: warning

js_vue_count
```

```{r}
#| content: valuebox
#| title: "TypeScript Files"
#| icon: check-lg
#| color: success

ts_file_count
```

```{r}
#| content: valuebox
#| title: "JavaScript Files"
#| icon: hourglass
#| color: warning

js_file_count
```

## Row {.tabset}

```{r}
#| title: "TypeScript Vue Components"

ts_vue_components |> render_table(column_name = "Components")
```

```{r}
#| title: "JavaScript Vue Components"

js_vue_components |> render_table(column_name = "Components")
```

```{r}
#| title: "TypeScript Files"

ts_files |> render_table(column_name = "Components")
```

```{r}
#| title: "JavaScript Files"

js_files |> render_table(column_name = "Components")
```
