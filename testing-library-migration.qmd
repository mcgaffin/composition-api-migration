---
title: Testing Library Migration Dashboard
format:
  dashboard:
    logo: images/vuejs-forward-logo.png
    nav-buttons:
      - icon: github
        href: https://github.com/mcgaffin/composition-api-migration
        target: _parent
---

```{r setup}
source("R/github_utils.R")

request_test_files <- function(search_str) {
  results <- request_all_pages(search_str, path = "ui/src", extension = "ts")

  # Filter to only .test.ts or .test.js files
  test_items <- results$items |> keep(~grepl('\\.test\\.(ts|js)$', .x$path))

  list(count = length(test_items), items = test_items)
}
```

```{r testing-library-suites}
# Testing Library test suites (import render from @testing-library)
testing_library_results <- request_test_files("@testing-library")

testing_library_count <- testing_library_results$count
testing_library_suites <- testing_library_results$items |>
  map(get_names_from_git_response)
```

```{r vue-test-utils-suites}
# Vue Test Utils test suites (import mount from @vue/test-utils)
vue_test_utils_results <- request_test_files("@vue/test-utils")

vue_test_utils_count <- vue_test_utils_results$count
vue_test_utils_suites <- vue_test_utils_results$items |>
  map(get_names_from_git_response)
```

## Row

```{r}
#| content: valuebox
#| title: "Testing Library Migration Progress"
#| icon: speedometer
#| color: primary

glue('{calculate_progress(testing_library_count, vue_test_utils_count)}%')
```

```{r}
#| content: valuebox
#| title: "Testing Library Suites"
#| icon: check-lg
#| color: success

testing_library_count
```

```{r}
#| content: valuebox
#| title: "Vue Test Utils Suites"
#| icon: hourglass
#| color: warning

vue_test_utils_count
```

## Row {.tabset}

```{r}
#| title: "Testing Library Suites"

testing_library_suites |> render_table(column_name = "TestSuites")
```

```{r}
#| title: "Vue Test Utils Suites"

vue_test_utils_suites |> render_table(column_name = "TestSuites")
```
