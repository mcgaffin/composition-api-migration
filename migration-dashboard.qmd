---
title: Composition API Migration Dashboard
format:
  dashboard
---

```{r search-migration-complete}
library(dplyr)
library(httr2)
library(jsonlite)
library(kableExtra)
library(knitr)
library(purrr)
library(stringr)
library(tibble)

GITHUB_API_KEY <- Sys.getenv("GITHUB_API_KEY")
GITHUB_API_HOST <- 'https://api.github.com'
GITHUB_SEARCH_PATH <- 'search/code'



get_names_from_git_response <- function(item) {
  item$path |> str_replace('ui/dashboard/src/', '')
}
```

```{r composition-query}

composition_results <- request(GITHUB_API_HOST) |> 
  req_url_path(GITHUB_SEARCH_PATH) |>
  req_url_query(
    q = I('"script%20setup"+language:Vue+in:file+repo:rstudio/connect'),
    per_page = 100
  ) |> 
  req_auth_basic("mcgaffin", GITHUB_API_KEY) |>
  req_perform() |>
  resp_body_json()

migrated_count <- composition_results$total_count
migrated_components <- composition_results$items |>
  map(get_names_from_git_response)
```

```{r search-options-vue}
resp_options_vue <- request(GITHUB_API_HOST) |> 
  req_url_path(GITHUB_SEARCH_PATH) |>
  req_url_query(
    q = I('"export%20default%20{"+language:Vue+in:file+repo:rstudio/connect'),
    per_page = 100
  ) |> 
  req_auth_basic("mcgaffin", GITHUB_API_KEY) |>
  req_perform() |>
  resp_body_json()

vue_options_total <- resp_options_vue$total_count
vue_components <- resp_options_vue$items |>
  map(get_names_from_git_response)
```

::: {.callout-warning}
## Work In Progress

The Composition API count appears to be accurate, but the Options API count is unconfirmed. The list of components is not really working at the moment.
:::

## Row

```{r}
#| content: valuebox
#| title: "Composition API Components"
#| icon: check
#| color: primary

migrated_count
```

```{r}
#| content: valuebox
#| title: "Options API Components"
#| icon: hourglass
#| color: warning

vue_options_total
```

## Row {.tabset}

```{r}
#| title: "Composition API"

tbsy <- data.frame(Components = unlist(migrated_components)) |>
  as_tibble() |>
  arrange(Components)

tbsy |> kbl() |> kable_styling()
```

```{r}
#| title: Options API

data.frame(Components = unlist(vue_components)) |>
  as_tibble() |>
  arrange(Components) |>
  kbl() |>
  kable_styling()
```
